{% extends "base.html" %}
{% load static %}

{% block title %}Prenota Ora - La Scarpetta{% endblock %}

{% block css_files %}
    <!-- CSS Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <!-- Custom CSS file -->
    <link rel="stylesheet" href="{% static 'gestionale/prenota_tavolo.css' %}">
    <link rel="stylesheet" href="{% static 'pages/Homepage.css' %}">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Glacial+Indifference&family=Engagement&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}
    
<body>
    <nav class="navbar">
        <div class="menu left">
            <!-- Italian -->
            <a href="{% url 'Homepage' %}#container1-1" class="lang lang-it">Chi Siamo</a> <!-- modified -->
            <a href="{% url 'Homepage' %}#menu" class="lang lang-it">Il Menù</a> <!-- modified -->
            <!-- English -->
            <a href="{% url 'Homepage' %}#container1-1" class="lang lang-en" style="display: none;">About Us</a> <!-- modified -->
            <a href="{% url 'Homepage' %}#menu" class="lang lang-en" style="display: none;">Our Menu</a> <!-- modified -->
        </div>
        <div class="logo">
            <a href="{% url 'Homepage' %}#starting">
                <img src="{% static 'pages/images/Logosvgcentrato(1).webp' %}" alt="Logo La Scarpetta">
            </a>
        </div>
        <div class="menu right">
            <!-- Italian -->
            <a href="{% url 'Homepage' %}#contatti" class="lang lang-it">Contattaci</a>
            <a href="{% url 'gestionale:prenota_tavolo' %}" id="booking-button" class="lang lang-it">Prenota Ora</a>
            <!-- English -->
            <a href="{% url 'Homepage' %}#contatti" class="lang lang-en" style="display: none;">Contact Us</a>
            <a href="{% url 'gestionale:prenota_tavolo' %}" id="booking-button" class="lang lang-en" style="display: none;">Book Now</a>
            
            <!-- Language Switcher -->
            <div class="language-switcher"> 
                <button onclick="setLanguage('it')" class="lang-button">
                    <img src="{% static 'pages/images/bandieraitaliana.png' %}" alt="Italiano" class="flag-icon">
                </button>
                <button onclick="setLanguage('en')" class="lang-button">
                    <img src="{% static 'pages/images/usa-flag.png' %}" alt="English" class="flag-icon">
                </button>
            </div>
        </div>
        <!-- Icona del menu hamburger -->
        <div class="menu-icon" id="menu-icon">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <!-- Menu Mobile -->
    <div class="mobile-menu" id="mobile-menu">
        <!-- Lingua italiana -->
        <a href="{% url 'Homepage'%}#scritta" id="chi" class="lang lang-it">Chi Siamo</a>
        <a href="{% url 'Homepage'%}#menu" class="lang lang-it">Il Menù</a>
        <a href="{% url 'Homepage'%}#contattiMobile" class="lang lang-it">Contattaci</a>
        <a href="{% url 'gestionale:prenota_tavolo' %}" id="booking-button-mobile" class="lang lang-it">Prenota Ora</a>
    
        <!-- Lingua inglese -->
        <a href="{% url 'Homepage'%}#scritta" id="chi" class="lang lang-en" style="display: none;">About Us</a>
        <a href="{% url 'Homepage'%}#menu" class="lang lang-en" style="display: none;">Our Menu</a>
        <a href="{% url 'Homepage'%}#contattiMobile" class="lang lang-en" style="display: none;">Contact Us</a>
        <a href="{% url 'gestionale:prenota_tavolo' %}" id="booking-button-mobile" class="lang lang-en" style="display: none;">Book Now</a>
        <a>
        <!-- Language Switcher per versione mobile -->
        <div class="language-switcher-mobile">
            <button onclick="setLanguage('it')" class="lang-button-mobile">
                <img src="{% static 'pages/images/bandieraitaliana.png' %}" alt="Italiano" class="flag-icon">
            </button>
            <button onclick="setLanguage('en')" class="lang-button-mobile">
                <img src="{% static 'pages/images/usa-flag.png' %}" alt="English" class="flag-icon">
            </button>
        </div>
    </a>
    </nav>
      <!-- Reservation Form -->
    <div class="content-wrapper">
        <div class="reservation-container">
            <h1><i class="fas fa-utensils"></i> <span class="lang lang-it">Prenota il tuo Tavolo</span><span class="lang lang-en" style="display: none;">Book Your Table</span></h1>

            <form method="post" action="{% url 'gestionale:prenota_tavolo' %}" class="reservation-form">
                {% csrf_token %}
                {{ form.non_field_errors }}

                <div class="form-group">
                    <label for="id_first_name"><i class="fas fa-user"></i> <span class="lang lang-it">Nome</span><span class="lang lang-en" style="display: none;">First Name</span></label>
                    {{ form.first_name }}
                </div>

                <div class="form-group">
                    <label for="id_last_name"><i class="fas fa-user"></i> <span class="lang lang-it">Cognome</span><span class="lang lang-en" style="display: none;">Last Name</span></label>
                    {{ form.last_name }}
                </div>

                <div class="form-group">
                    <label for="id_phone_number"><i class="fas fa-phone"></i> <span class="lang lang-it">Numero di Telefono</span><span class="lang lang-en" style="display: none;">Phone Number</span></label>
                    {{ form.phone_number }}
                </div>
                <div class="form-group">
                    <label for="id_email"><i class="fas fa-envelope"></i> <span class="lang lang-it">Email</span><span class="lang lang-en" style="display: none;">Email</span></label>
                    {{ form.email }}
                </div>

                <div class="form-group">
                    <label for="id_guests"><i class="fas fa-user-friends"></i> <span class="lang lang-it">Numero di Persone</span><span class="lang lang-en" style="display: none;">Number of Guests</span></label>
                    {{ form.guests }}
                </div>

                <div class="form-group">
                    <label for="id_reservation_date">
                        <i class="fas fa-calendar-alt"></i>
                        <span class="lang lang-it">Data</span>
                        <span class="lang lang-en" style="display: none;">Date</span>
                    </label>
                    {{ form.reservation_date }}
                </div>
                

                <div class="form-group">
                    <label for="id_reservation_time"><i class="fas fa-clock"></i> <span class="lang lang-it">Ora</span><span class="lang lang-en" style="display: none;">Time</span></label>
                    {{ form.reservation_time }}
                </div>

                <!-- Consents -->
                <div class="consents">
                    <h2><i class="fas fa-check-circle"></i> <span class="lang lang-it">Consensi</span><span class="lang lang-en" style="display: none;">Consents</span></h2>

                    <div class="consent-group">
                        {{ form.cookie_consent }}
                        <label for="id_cookie_consent"><span class="lang lang-it">Accetto i cookie e la privacy policy (obbligatorio)</span><span class="lang lang-en" style="display: none;">I accept cookies and the privacy policy (required)</span></label>
                    </div>
                    <div class="consent-group">
                        {{ form.profiling_consent }}
                        <label for="id_profiling_consent"><span class="lang lang-it">Accetto la profilazione dei dati</span><span class="lang lang-en" style="display: none;">I agree to data profiling</span></label>
                    </div>
                    <div class="consent-group">
                        {{ form.promotional_sms_consent }}
                        <label for="id_promotional_sms_consent"><span class="lang lang-it">Accetto di ricevere SMS promozionali</span><span class="lang lang-en" style="display: none;">I agree to receive promotional SMS</span></label>
                    </div>
                    <div class="accept-all">
                        {{ form.accept_all }}
                        <label for="id_accept_all"><span class="lang lang-it">Accetta tutto</span><span class="lang lang-en" style="display: none;">Accept all</span></label>
                    </div>
                </div>

                <!-- Booking Button -->
                <button type="submit" class="submit-btn btn btn-primary w-100">
                    <i class="fas fa-check"></i> <span class="lang lang-it">Prenota</span><span class="lang lang-en" style="display: none;">Book</span>
                </button>
            </form>
        </div>
    </div>

</body>
<script>
    // Initialize Flatpickr on the date input field
    document.addEventListener("DOMContentLoaded", function () {
        flatpickr("#id_reservation_date", {
            dateFormat: "Y-m-d",
            minDate: "today",
            onChange: function (selectedDates, dateStr) {
                fetchDisabledTimeSlots(dateStr); // Aggiorna gli slot disabilitati alla selezione della data
            }
        });
    });

    // Funzione per recuperare le fasce orarie disabilitate per una data specifica
    function fetchDisabledTimeSlots(date) {
        fetch(`/gestionale/get-disabled-time-slots/?date=${date}`)
            .then(response => response.json())
            .then(data => {
                updateTimeSlots(data.disabled_time_slots);
            })
            .catch(error => {
                console.error("Errore nel recupero delle fasce orarie disabilitate:", error);
            });
    }

    // Funzione per aggiornare gli orari disponibili nel menu a tendina
    function updateTimeSlots(disabledTimeSlots) {
        const timeSelect = document.getElementById("id_reservation_time");
        const options = timeSelect.options;

        // Reimposta tutti gli orari come abilitati
        for (let i = 0; i < options.length; i++) {
            options[i].disabled = false;
            options[i].textContent = options[i].value; // Ripristina il testo originale
        }

        // Disabilita gli orari che rientrano nelle fasce disabilitate
        disabledTimeSlots.forEach(slot => {
            const slotStart = slot.start_time;
            const slotEnd = slot.end_time;

            for (let i = 0; i < options.length; i++) {
                const optionTime = options[i].value;
                if (optionTime >= slotStart && optionTime < slotEnd) {
                    options[i].disabled = true;
                    if (!options[i].textContent.includes("(Non disponibile)")) {
                        options[i].textContent += " (Non disponibile)";
                    }
                }
            }
        });

        console.log("Orari aggiornati con le fasce disabilitate:", disabledTimeSlots);
    }
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const navbar = document.querySelector('.navbar');
        const mobileMenu = document.getElementById('mobile-menu');
        const menuIcon = document.getElementById('menu-icon');

        // Mostra/Nasconde il menu mobile al clic sull'icona
        menuIcon.addEventListener('click', function () {
            mobileMenu.classList.toggle('active');
            this.classList.toggle('active');
        });

        // Chiude il menu mobile cliccando fuori
        document.addEventListener('click', function (event) {
            if (!menuIcon.contains(event.target) && !mobileMenu.contains(event.target)) {
                mobileMenu.classList.remove('active');
                menuIcon.classList.remove('active');
            }
        });

        // Aggiorna la posizione della navbar
        function adjustMenuPosition() {
            const navbarHeight = navbar.offsetHeight;
            document.documentElement.style.setProperty('--navbar-height', `${navbarHeight}px`);
        }

        adjustMenuPosition();
        window.addEventListener("resize", adjustMenuPosition);
    });
    
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const navbar = document.querySelector(".navbar");
        const languageSwitcher = document.querySelector(".language-switcher");

        // Posiziona il selettore della lingua sotto la navbar
        const navbarHeight = navbar.offsetHeight;
        languageSwitcher.style.top = `${navbarHeight + 10}px`;
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const mobileMenu = document.getElementById("mobile-menu");
        const menuIcon = document.getElementById("menu-icon");

        // Aggiungi un listener per lo scorrimento della finestra
        window.addEventListener("scroll", function () {
            if (mobileMenu.classList.contains("active")) {
                mobileMenu.classList.remove("active");
                menuIcon.classList.remove("active");
            }
        });
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const acceptAllCheckbox = document.querySelector(".accept-all input[type='checkbox']");
        const consentCheckboxes = document.querySelectorAll(".consent-group input[type='checkbox']");

        // Seleziona/Deseleziona tutti i consensi
        if (acceptAllCheckbox) {
            acceptAllCheckbox.addEventListener("change", function () {
                consentCheckboxes.forEach(checkbox => checkbox.checked = this.checked);
            });
        }
    });
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
function setLanguage(lang) {
    const elementsIt = document.querySelectorAll('.lang-it');
    const elementsEn = document.querySelectorAll('.lang-en');

    if (lang === 'it') {
        elementsIt.forEach(el => el.style.display = 'inline');
        elementsEn.forEach(el => el.style.display = 'none');
    } else if (lang === 'en') {
        elementsIt.forEach(el => el.style.display = 'none');
        elementsEn.forEach(el => el.style.display = 'inline');
    }

    // Salva la scelta della lingua in localStorage
    localStorage.setItem('preferredLanguage', lang);
}

// Imposta la lingua iniziale al caricamento della pagina
document.addEventListener('DOMContentLoaded', function () {
    const preferredLanguage = localStorage.getItem('preferredLanguage') || 'it'; // Default italiano
    setLanguage(preferredLanguage);
});
</script>

    
            {% endblock %}
